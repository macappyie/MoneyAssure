<!DOCTYPE html>
<html>
<head>
  <title>{{ symbol }} â€“ 5 Min Chart</title>
  <script src="https://unpkg.com/lightweight-charts@4.0.1/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    body { margin:0; background:#000; color:#fff; }
    #title { padding:10px; font-size:18px; font-weight:bold; }
    #chart { height: calc(100vh - 50px); }
  </style>
</head>
<body>

<div id="title">ðŸ“ˆ {{ symbol }} â€” 5 Min</div>
<div id="chart"></div>

<script>
const chart = LightweightCharts.createChart(document.getElementById("chart"), {
  layout: { background:{color:"#000"}, textColor:"#ccc" },
  grid: { vertLines:{color:"#222"}, horzLines:{color:"#222"} },
  timeScale: { timeVisible:true },
});

const candle = chart.addCandlestickSeries({
  upColor:"#00e676",
  downColor:"#ff1744",
  borderUpColor:"#00e676",
  borderDownColor:"#ff1744",
  wickUpColor:"#00e676",
  wickDownColor:"#ff1744"
});

const sma = chart.addLineSeries({
  color:"#2196f3",
  lineWidth:2
});

fetch(`/api/chart/{{ symbol }}`)
.then(r => r.json())
.then(d => {
  if (!d.candles) return;

  candle.setData(d.candles);
  sma.setData(d.sma50);

  if (d.hi10) {
    candle.createPriceLine({
      price: d.hi10,
      color: "#ffffff",
      lineWidth: 1,
      lineStyle: 2
    });
  }

  if (d.lo10) {
    candle.createPriceLine({
      price: d.lo10,
      color: "#ffffff",
      lineWidth: 1,
      lineStyle: 2
    });
  }

  chart.timeScale().fitContent();
});
</script>

</body>
</html>

